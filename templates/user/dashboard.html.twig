{% extends 'base.html.twig' %}

{% block title %}Your dashboard — ARTEUM{% endblock %}

{% block body %}
{# === Background (matches admin: dark w/ purple glow + subtle grid) === #}
<div class="fixed inset-0 -z-10 overflow-hidden">
  <div class="absolute inset-0 bg-[#07070b]"></div>
  <div class="absolute inset-0 opacity-50 [background:radial-gradient(1100px_circle_at_18%_18%,rgba(99,102,241,.30),transparent_60%),radial-gradient(900px_circle_at_85%_30%,rgba(168,85,247,.22),transparent_55%),radial-gradient(1000px_circle_at_55%_95%,rgba(99,102,241,.15),transparent_55%)]"></div>
  <div class="absolute inset-0 opacity-[0.08] [background-image:linear-gradient(to_right,white_1px,transparent_1px),linear-gradient(to_bottom,white_1px,transparent_1px)] [background-size:72px_72px]"></div>
  <div class="absolute inset-0 bg-gradient-to-b from-transparent via-black/10 to-black/30"></div>
</div>

{# === Shell === #}
<div class="relative min-h-screen text-white">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10 sm:py-14">

    {# === Top bar (admin-like) === #}
    <header class="mb-8">
      <div class="flex flex-col gap-5 lg:flex-row lg:items-center lg:justify-between">
        <div class="space-y-2">
          <div class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-neutral-200 backdrop-blur">
            <span class="h-2 w-2 rounded-full bg-emerald-400 shadow-[0_0_0_4px_rgba(16,185,129,.14)]"></span>
            Logged in as <span class="font-semibold text-white">{{ user.username }}</span>
          </div>
          <h1 class="text-4xl font-extrabold tracking-tight">Dashboard</h1>
          <p class="text-sm text-neutral-300/90">Manage your tours and bookings in one place.</p>
        </div>

        <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
          <div class="relative">
            <input
              type="text"
              placeholder="Search bookings…"
              class="w-full sm:w-64 rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-sm text-white placeholder:text-neutral-400 backdrop-blur outline-none focus:ring-2 focus:ring-indigo-400/40"
            />
            <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400">⌕</span>
          </div>

          <a href="{{ path('app_user_book_tour') }}"
             class="inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-indigo-500 via-violet-500 to-fuchsia-500 px-4 py-2.5 text-sm font-semibold text-white shadow-lg shadow-indigo-500/20 ring-1 ring-white/10 transition hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-indigo-400/60">
            + Book a tour
          </a>

          <a href="{{ path('app_user_bookings') }}"
             class="inline-flex items-center justify-center gap-2 rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-sm font-semibold text-neutral-100 backdrop-blur transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/20">
            My bookings
          </a>

          <form action="{{ path('app_logout') }}" method="post">
            <button type="submit"
                    class="inline-flex items-center justify-center gap-2 rounded-xl border border-white/10 bg-white/5 px-4 py-2.5 text-sm font-semibold text-neutral-100 backdrop-blur transition hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/20">
              Logout
            </button>
          </form>
        </div>
      </div>
    </header>

    {# === Layout: left mini sidebar card + main content (admin vibe) === #}
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

      {# --- Left Panel (profile / quick nav) --- #}
      <aside class="lg:col-span-4 space-y-6">
        <section class="rounded-3xl border border-white/10 bg-white/5 p-6 shadow-xl shadow-black/30 backdrop-blur">
          <div class="flex items-start justify-between gap-4">
            <div>
              <h2 class="text-sm font-semibold text-neutral-200">ARTEUM</h2>
              <p class="mt-1 text-xs text-neutral-300/80">User portal</p>
            </div>
            <span class="rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs font-semibold text-neutral-100">
              Account
            </span>
          </div>

          <div class="mt-6 flex items-center gap-4">
            <div class="h-12 w-12 rounded-2xl bg-gradient-to-br from-indigo-500/25 to-violet-500/15 ring-1 ring-white/10 flex items-center justify-center font-extrabold">
              {{ user.username|slice(0,1)|upper }}
            </div>
            <div class="min-w-0">
              <div class="truncate text-base font-semibold text-white">{{ user.username }}</div>
              <div class="mt-1 text-xs text-neutral-300/80">
                Member since: {{ user.createdAt ? user.createdAt|date('Y-m-d') : 'N/A' }}
              </div>
            </div>
          </div>

          <div class="mt-5 flex flex-wrap gap-2">
            {% for role in user.roles %}
              <span class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold ring-1
                {{ role == 'ROLE_ADMIN'
                  ? 'bg-amber-400/15 text-amber-100 ring-amber-400/25'
                  : 'bg-white/5 text-neutral-100 ring-white/10' }}">
                <span class="h-1.5 w-1.5 rounded-full {{ role == 'ROLE_ADMIN' ? 'bg-amber-300' : 'bg-indigo-300/80' }}"></span>
                {{ role|replace({'ROLE_': ''}) }}
              </span>
            {% endfor %}
          </div>

          <div class="mt-6 space-y-2">
            <a href="{{ path('app_user_book_tour') }}"
               class="flex items-center justify-between rounded-2xl border border-white/10 bg-black/20 px-4 py-3 text-sm font-semibold text-neutral-100 hover:bg-white/10 transition">
              Book a tour
              <span class="text-white/60">→</span>
            </a>
            <a href="{{ path('app_user_bookings') }}"
               class="flex items-center justify-between rounded-2xl border border-white/10 bg-black/20 px-4 py-3 text-sm font-semibold text-neutral-100 hover:bg-white/10 transition">
              View bookings
              <span class="text-white/60">→</span>
            </a>

            {% if is_granted('ROLE_ADMIN') %}
              <a href="{{ path('app_tour_index') }}"
                 class="flex items-center justify-between rounded-2xl border border-amber-400/20 bg-amber-400/10 px-4 py-3 text-sm font-semibold text-amber-100 hover:bg-amber-400/15 transition">
                Admin: Tours
                <span class="text-amber-100/80">→</span>
              </a>
            {% endif %}
          </div>

          <div class="mt-6 rounded-2xl border border-white/10 bg-black/20 p-4">
            <p class="text-xs text-neutral-300/90">
              Tip: You can manage status and details inside <span class="font-semibold text-white">My bookings</span>.
            </p>
          </div>
        </section>
      </aside>

      {# --- Right: cards + table (admin-like table styling) --- #}
      <section class="lg:col-span-8 space-y-6">

        {# KPIs row #}
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="rounded-3xl border border-white/10 bg-white/5 p-5 shadow-xl shadow-black/30 backdrop-blur">
            <div class="flex items-center justify-between">
              <p class="text-xs font-semibold text-neutral-200">Upcoming Tours</p>
              <span class="rounded-full bg-indigo-500/15 text-indigo-100 ring-1 ring-indigo-400/20 px-2.5 py-1 text-[11px] font-semibold">
                Active
              </span>
            </div>
            <div class="mt-4 text-3xl font-extrabold">{{ upcomingCount }}</div>
            <p class="mt-2 text-xs text-neutral-300/90">Scheduled in the future</p>
          </div>

          <div class="rounded-3xl border border-white/10 bg-white/5 p-5 shadow-xl shadow-black/30 backdrop-blur">
            <div class="flex items-center justify-between">
              <p class="text-xs font-semibold text-neutral-200">Past Tours</p>
              <span class="rounded-full bg-white/5 text-neutral-100 ring-1 ring-white/10 px-2.5 py-1 text-[11px] font-semibold">
                History
              </span>
            </div>
            <div class="mt-4 text-3xl font-extrabold">{{ pastCount }}</div>
            <p class="mt-2 text-xs text-neutral-300/90">Completed tours</p>
          </div>

          <div class="rounded-3xl border border-white/10 bg-white/5 p-5 shadow-xl shadow-black/30 backdrop-blur">
            <p class="text-xs font-semibold text-neutral-200">Actions</p>
            <div class="mt-4 space-y-2">
              <a href="{{ path('app_user_book_tour') }}"
                 class="block rounded-2xl border border-white/10 bg-black/20 px-3 py-2 text-sm font-semibold text-neutral-100 hover:bg-white/10 transition">
                + Create new tour
              </a>
              <a href="{{ path('app_user_bookings') }}"
                 class="block rounded-2xl border border-white/10 bg-black/20 px-3 py-2 text-sm font-semibold text-neutral-100 hover:bg-white/10 transition">
                ↗ View bookings
              </a>
            </div>
          </div>
        </div>


    <footer class="mt-10 text-center text-xs text-neutral-400">
      © {{ "now"|date("Y") }} ARTEUM
    </footer>

  </div>
</div>
{% endblock %}
